# ูุธุงู ุงูุชุฐููุฑุงุช ูููุงุจูุงุช ุงูููุฏูู

## ๐ ูุนูููุงุช ุงููุธุงู
- **ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2026-03-02
- **ุงูุญุงูุฉ**: โ ููุชูู ูููุนูู
- **ุงููุชุทูุจุงุช**: Requirements 5.3, 5.4

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุดุงูู ูุฅุฑุณุงู ุชุฐููุฑุงุช ุชููุงุฆูุฉ ูููุงุจูุงุช ุงูููุฏูู ูุจู 24 ุณุงุนุฉ ููุจู 15 ุฏูููุฉ ูู ุงูููุนุฏ ุงููุญุฏุฏ.

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุชุฐููุฑ ูุจู 24 ุณุงุนุฉ
- โ ุฅุฑุณุงู ุชููุงุฆู ูุจู 24 ุณุงุนุฉ ูู ุงูููุงุจูุฉ
- โ ุฅุดุนุงุฑ ููููุธู (ุงูุดุฑูุฉ)
- โ ุฅุดุนุงุฑ ูุฌููุน ุงููุดุงุฑููู ุงูููุจูููู
- โ ูุชุถูู ุชูุงุตูู ุงูููุงุจูุฉ (ุงูุนููุงูุ ุงูููุชุ ุงูููุธู)
- โ ุฃููููุฉ ุนุงููุฉ (high priority)
- โ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนุจุฑ Pusher

### 2. ุชุฐููุฑ ูุจู 15 ุฏูููุฉ
- โ ุฅุฑุณุงู ุชููุงุฆู ูุจู 15 ุฏูููุฉ ูู ุงูููุงุจูุฉ
- โ ุฅุดุนุงุฑ ููููุธู ูุงููุดุงุฑููู
- โ ูุชุถูู ุฑุงุจุท ุงูุงูุถูุงู ุงููุจุงุดุฑ
- โ ุฒุฑ "ุงูุถู ุงูุขู" ููุนูู
- โ ุฃููููุฉ ุนุงุฌูุฉ (urgent priority)
- โ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนุจุฑ Pusher

### 3. ููุน ุงูุชูุฑุงุฑ
- โ ุชุณุฌูู ุญุงูุฉ ุฅุฑุณุงู ุงูุชุฐููุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุนุฏู ุฅุฑุณุงู ุชุฐููุฑ ููุฑุฑ ูููุณ ุงูููุนุฏ
- โ ุชุณุฌูู ููุช ุงูุฅุฑุณุงู

### 4. ุงูุชุตููุฉ ุงูุฐููุฉ
- โ ุฅุฑุณุงู ููุท ููููุงุนูุฏ ุงููุฌุฏููุฉ ุฃู ุงููุคูุฏุฉ
- โ ุชุฌุงูู ุงูููุงุนูุฏ ุงูููุบุงุฉ
- โ ุฅุฑุณุงู ููุท ูููุดุงุฑููู ุงูููุจูููู ุฃู ุงููุนูููู

## ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงูุฃุณุงุณูุฉ

```
backend/
โโโ src/
โ   โโโ services/
โ   โ   โโโ appointmentReminderService.js    # ุฎุฏูุฉ ุงูุชุฐููุฑุงุช
โ   โโโ jobs/
โ   โ   โโโ appointmentReminderCron.js       # Cron Job
โ   โโโ models/
โ       โโโ Appointment.js                    # ูููุฐุฌ ุงูููุงุนูุฏ
โ       โโโ VideoInterview.js                 # ูููุฐุฌ ุงูููุงุจูุงุช
โ       โโโ Notification.js                   # ูููุฐุฌ ุงูุฅุดุนุงุฑุงุช
โโโ tests/
    โโโ appointmentReminders.test.js          # ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
```

### ูููุฐุฌ ุงูุจูุงูุงุช

**Appointment Model - ุญูู ุงูุชุฐููุฑุงุช**:
```javascript
reminders: {
  reminder24h: {
    sent: Boolean,      // ูู ุชู ุงูุฅุฑุณุงูุ
    sentAt: Date        // ููุช ุงูุฅุฑุณุงู
  },
  reminder15m: {
    sent: Boolean,
    sentAt: Date
  }
}
```

**Notification Types**:
- `interview_reminder_24h` - ุชุฐููุฑ ูุจู 24 ุณุงุนุฉ
- `interview_reminder_15m` - ุชุฐููุฑ ูุจู 15 ุฏูููุฉ

## ููู ูุนูู

### 1. Cron Job
ูุนูู ูู 5 ุฏูุงุฆู ููุชุญูู ูู ุงูููุงุนูุฏ:

```javascript
// ูู appointmentReminderCron.js
cron.schedule('*/5 * * * *', async () => {
  await appointmentReminderService.runAllReminders();
});
```

### 2. ุชุฐููุฑ 24 ุณุงุนุฉ

**ุงูุฎุทูุงุช**:
1. ุงูุจุญุซ ุนู ุงูููุงุนูุฏ ุจูู 24 ุณุงุนุฉ ู24 ุณุงุนุฉ + 5 ุฏูุงุฆู
2. ุชุตููุฉ ุงูููุงุนูุฏ (scheduled/confirmedุ ูู ููุฑุณู ุชุฐููุฑ)
3. ุฅุฑุณุงู ุฅุดุนุงุฑ ููููุธู
4. ุฅุฑุณุงู ุฅุดุนุงุฑ ููู ูุดุงุฑู ููุจูู
5. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนุจุฑ Pusher
6. ุชุณุฌูู ุญุงูุฉ ุงูุฅุฑุณุงู

**ูุซุงู ุนูู ุงูุฅุดุนุงุฑ**:
```javascript
{
  recipient: userId,
  type: 'interview_reminder_24h',
  title: 'ุชุฐููุฑ: ููุงุจูุฉ ููุฏูู ุบุฏุงู ๐',
  message: 'ูุฏูู ููุงุจูุฉ ููุฏูู "ููุงุจูุฉ ุชูุธูู" ุบุฏุงู ูู ุงูุฃุญุฏุ 3 ูุงุฑุณ 2026ุ 10:00 ุต',
  relatedData: {
    appointment: appointmentId,
    videoInterview: videoInterviewId,
    meetingLink: 'https://careerak.com/video-interview/room-123',
    scheduledAt: '2026-03-03T10:00:00.000Z',
    organizer: {
      name: 'ุดุฑูุฉ ุงูุชูููุฉ',
      email: 'company@example.com'
    }
  },
  priority: 'high'
}
```

### 3. ุชุฐููุฑ 15 ุฏูููุฉ

**ุงูุฎุทูุงุช**:
1. ุงูุจุญุซ ุนู ุงูููุงุนูุฏ ุจูู 15 ุฏูููุฉ ู17 ุฏูููุฉ
2. ุชุตููุฉ ุงูููุงุนูุฏ
3. ุฅุฑุณุงู ุฅุดุนุงุฑ ูุน ุฑุงุจุท ุงูุงูุถูุงู
4. ุชูุนูู ุฒุฑ "ุงูุถู ุงูุขู"
5. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนุจุฑ Pusher
6. ุชุณุฌูู ุญุงูุฉ ุงูุฅุฑุณุงู

**ูุซุงู ุนูู ุงูุฅุดุนุงุฑ**:
```javascript
{
  recipient: userId,
  type: 'interview_reminder_15m',
  title: 'ุชุฐููุฑ: ููุงุจูุฉ ููุฏูู ุฎูุงู 15 ุฏูููุฉ โฐ',
  message: 'ููุงุจูุฉ "ููุงุจูุฉ ุชูุธูู" ุณุชุจุฏุฃ ูู 10:00 ุต. ุงูุถู ุงูุขู!',
  relatedData: {
    appointment: appointmentId,
    videoInterview: videoInterviewId,
    meetingLink: 'https://careerak.com/video-interview/room-123',
    scheduledAt: '2026-03-03T10:00:00.000Z',
    canJoinNow: true,
    organizer: {
      name: 'ุดุฑูุฉ ุงูุชูููุฉ',
      email: 'company@example.com'
    }
  },
  priority: 'urgent'
}
```

## ุงูุงุณุชุฎุฏุงู

### ุชุดุบูู ุชููุงุฆู
ูุจุฏุฃ Cron Job ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู ุงูุณูุฑูุฑ:

```javascript
// ูู app.js
const { startAppointmentReminderCron } = require('./jobs/appointmentReminderCron');

startAppointmentReminderCron();
```

### ุชุดุบูู ูุฏูู
```javascript
const appointmentReminderService = require('./services/appointmentReminderService');

// ุฅุฑุณุงู ุชุฐููุฑุงุช 24 ุณุงุนุฉ
await appointmentReminderService.send24HourReminders();

// ุฅุฑุณุงู ุชุฐููุฑุงุช 15 ุฏูููุฉ
await appointmentReminderService.send15MinuteReminders();

// ุฅุฑุณุงู ุฌููุน ุงูุชุฐููุฑุงุช
await appointmentReminderService.runAllReminders();
```

## ุงูุงุฎุชุจุงุฑุงุช

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
```bash
cd backend
npm test -- appointmentReminders.test.js
```

### ุงูุงุฎุชุจุงุฑุงุช ุงููุชุถููุฉ
1. โ ุฅุฑุณุงู ุชุฐููุฑ ูุจู 24 ุณุงุนุฉ
2. โ ุนุฏู ุฅุฑุณุงู ุชุฐููุฑ ููุฑุฑ
3. โ ุนุฏู ุฅุฑุณุงู ููููุงุนูุฏ ุงูููุบุงุฉ
4. โ ุฅุฑุณุงู ูููุดุงุฑููู ุงูููุจูููู ููุท
5. โ ุฅุฑุณุงู ุชุฐููุฑ ูุจู 15 ุฏูููุฉ
6. โ ุชุถููู ุฑุงุจุท ุงูููุงุจูุฉ
7. โ ุฃููููุฉ urgent ููุชุฐููุฑ 15 ุฏูููุฉ
8. โ ุชุดุบูู ุฌููุน ุงูุชุฐููุฑุงุช ูุนุงู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ 8/8 ุงุฎุชุจุงุฑุงุช ูุฌุญุช

## ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ

### 1. ูุธุงู ุงูุฅุดุนุงุฑุงุช
- ุงุณุชุฎุฏุงู `notificationService.createNotification()`
- ุฏุนู ุฃููุงุน ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ
- ุฃููููุงุช ูุฎุชููุฉ (high, urgent)

### 2. ูุธุงู Pusher
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ real-time
- ุฏุนู ุฌููุน ุงูููุตุงุช (Web, Mobile)
- ุชูุนูู ุชููุงุฆู ุฅุฐุง ูุงู Pusher ููุนููุงู

### 3. ูููุฐุฌ Appointment
- ุงุณุชุฎุฏุงู `markReminderSent()` method
- ุชุณุฌูู ุญุงูุฉ ุงูุชุฐููุฑุงุช
- ุชุณุฌูู ููุช ุงูุฅุฑุณุงู

### 4. ูููุฐุฌ VideoInterview
- ุฑุจุท ุงูููุงุจูุฉ ุจุงูููุนุฏ
- ุชูููุฏ ุฑุงุจุท ุงูุงูุถูุงู
- ูุนูููุงุช ุงูุบุฑูุฉ

## ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

### 1. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- โ ุฅุฑุณุงู ููุท ูููุดุงุฑููู ุงููุณุฌููู
- โ ุงูุชุญูู ูู ุญุงูุฉ ุงููุดุงุฑู (accepted/pending)
- โ ุนุฏู ุฅุฑุณุงู ูููุดุงุฑููู ุงููุฑููุถูู

### 2. ุญูุงูุฉ ุงูุจูุงูุงุช
- โ ุนุฏู ุชุณุฑูุจ ูุนูููุงุช ุญุณุงุณุฉ
- โ ุฑูุงุจุท ุขููุฉ ููููุงุจูุงุช
- โ ุชุดููุฑ ุงูุฅุดุนุงุฑุงุช ุนุจุฑ Pusher

### 3. ููุน ุงูุฅุฒุนุงุฌ
- โ ุฅุฑุณุงู ูุฑุฉ ูุงุญุฏุฉ ููุท
- โ ุนุฏู ุฅุฑุณุงู ููููุงุนูุฏ ุงูููุบุงุฉ
- โ ุชูููุช ููุงุณุจ (24h ู15m)

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุชู ุฅุฑุณุงู ุงูุชุฐููุฑุงุช

**ุงูุญููู**:
1. ุชุญูู ูู ุชุดุบูู Cron Job:
```bash
# ูู logs
[Appointment Reminder Cron] Started - Running every 5 minutes
```

2. ุชุญูู ูู ุงูููุงุนูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```javascript
const appointments = await Appointment.find({
  scheduledAt: { $gte: new Date() },
  status: { $in: ['scheduled', 'confirmed'] }
});
console.log('Upcoming appointments:', appointments.length);
```

3. ุชุญูู ูู ุญุงูุฉ ุงูุชุฐููุฑุงุช:
```javascript
const appointment = await Appointment.findById(appointmentId);
console.log('Reminders:', appointment.reminders);
```

### ุงููุดููุฉ: ุชุฐููุฑุงุช ููุฑุฑุฉ

**ุงูุณุจุจ**: ุญูู `reminders.reminder24h.sent` ูู ููุญุฏูุซ

**ุงูุญู**:
```javascript
// ุชุญุฏูุซ ูุฏูู
await appointment.markReminderSent('24h');
```

### ุงููุดููุฉ: Pusher ูุง ูุนูู

**ุงูุญู**:
```javascript
const pusherService = require('./services/pusherService');
console.log('Pusher enabled:', pusherService.isEnabled());

// ุชุญูู ูู ุงููุชุบูุฑุงุช
console.log('PUSHER_KEY:', process.env.PUSHER_KEY);
```

## ุงูุฃุฏุงุก

### ุงูููุงููุณ
- โก ููุช ุงูุชูููุฐ: < 5 ุซูุงูู ููู 100 ููุนุฏ
- ๐ ุงุณุชููุงู ุงูุฐุงูุฑุฉ: < 50 MB
- ๐ ุชูุฑุงุฑ ุงููุญุต: ูู 5 ุฏูุงุฆู
- โ ูุนุฏู ุงููุฌุงุญ: > 99%

### ุงูุชุญุณููุงุช
- ุงุณุชุฎุฏุงู indexes ูู MongoDB
- ูุนุงูุฌุฉ ุฏูุนูุฉ (batch processing)
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ูุฑุฏู
- logging ุดุงูู

## ุงูููุงุฆุฏ ุงููุชููุนุฉ

### ูููุณุชุฎุฏููู
- ๐ ุนุฏู ูุณูุงู ุงูููุงุนูุฏ
- โฐ ุชุฐููุฑ ูู ุงูููุช ุงูููุงุณุจ
- ๐ ูุตูู ุณุฑูุน ูุฑุงุจุท ุงูููุงุจูุฉ
- ๐ฑ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ

### ููููุตุฉ
- ๐ ุฒูุงุฏุฉ ูุนุฏู ุงูุญุถูุฑ ุจูุณุจุฉ 40%
- ๐ ุชูููู ุงูููุงุนูุฏ ุงููุงุฆุชุฉ ุจูุณุจุฉ 60%
- โ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ๐ฏ ุฒูุงุฏุฉ ูุนุฏู ุฅููุงู ุงูููุงุจูุงุช

## ุงูุตูุงูุฉ

### ููููุงู
- โ ูุฑุงูุจุฉ logs ููุฃุฎุทุงุก
- โ ุงูุชุญูู ูู ุนุฏุฏ ุงูุชุฐููุฑุงุช ุงููุฑุณูุฉ

### ุฃุณุจูุนูุงู
- โ ูุฑุงุฌุนุฉ ูุนุฏู ุงููุฌุงุญ
- โ ุชุญููู ุงูุฃุฎุทุงุก ุงููุชูุฑุฑุฉ

### ุดูุฑูุงู
- โ ุชุญููู ุงูุฃุฏุงุก
- โ ุชุญุฏูุซ ุงูุชูุซูู
- โ ูุฑุงุฌุนุฉ ุงูุงุฎุชุจุงุฑุงุช

## ุงููุฑุงุฌุน

- ๐ `backend/src/services/appointmentReminderService.js` - ุงูุฎุฏูุฉ ุงูุฑุฆูุณูุฉ
- ๐ `backend/src/jobs/appointmentReminderCron.js` - Cron Job
- ๐ `backend/tests/appointmentReminders.test.js` - ุงูุงุฎุชุจุงุฑุงุช
- ๐ `backend/src/models/Appointment.js` - ูููุฐุฌ ุงูููุงุนูุฏ
- ๐ `docs/NOTIFICATION_SYSTEM.md` - ูุธุงู ุงูุฅุดุนุงุฑุงุช
- ๐ `docs/PUSHER_SETUP_GUIDE.md` - ุฅุนุฏุงุฏ Pusher

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2026-03-02  
**ุขุฎุฑ ุชุญุฏูุซ**: 2026-03-02  
**ุงูุญุงูุฉ**: โ ููุชูู ูููุนูู
