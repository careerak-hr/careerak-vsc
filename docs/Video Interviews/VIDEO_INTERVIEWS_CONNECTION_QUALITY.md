# ูุธุงู ูุฑุงูุจุฉ ุฌูุฏุฉ ุงูุงุชุตุงู ูู ุงูููุช ุงููุนูู

## ๐ ูุนูููุงุช ุงููุซููุฉ
- **ุงูุชุงุฑูุฎ**: 2026-03-02
- **ุงูุญุงูุฉ**: โ ููุชูู
- **ุงููุชุทูุจุงุช**: Requirements 1.5, 6.6

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุดุงูู ููุฑุงูุจุฉ ูุนุฑุถ ุฌูุฏุฉ ุงูุงุชุตุงู ูู ุงูููุช ุงููุนูู ุฃุซูุงุก ููุงุจูุงุช ุงูููุฏูู. ูุฌูุน ุฅุญุตุงุฆูุงุช WebRTC ููุญุณุจ ูุณุชูู ุงูุฌูุฏุฉ ููุนุฑุถ ูุคุดุฑ ูุฑุฆู ูููุณุชุฎุฏููู.

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### ุงูููููุงุช ุงูุฑุฆูุณูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Frontend Layer                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ConnectionQualityIndicator (UI Component)              โ
โ  ConnectionQualityMonitor (Stats Collector)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   WebRTC Layer                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  RTCPeerConnection.getStats()                           โ
โ  - Inbound RTP Stats                                    โ
โ  - Outbound RTP Stats                                   โ
โ  - Candidate Pair Stats                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           โ
                           โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Backend Layer                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ConnectionQualityService (Quality Calculator)          โ
โ  - Calculate Quality Score                              โ
โ  - Generate Recommendations                             โ
โ  - Analyze Trends                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงูููุงููุณ ุงููุชุชุจุนุฉ

### 1. Latency (ุงูุชุฃุฎูุฑ)
- **ุงููุตู**: ุฒูู ุงูุงุณุชุฌุงุจุฉ (Round Trip Time)
- **ุงููุญุฏุฉ**: ูููู ุซุงููุฉ (ms)
- **ุงููุตุฏุฑ**: `RTCIceCandidatePair.currentRoundTripTime`
- **ุงูุนุชุจุงุช**:
  - ููุชุงุฒ: < 150ms
  - ุฌูุฏ: < 300ms
  - ููุจูู: < 500ms
  - ุถุนูู: โฅ 500ms

### 2. Packet Loss (ููุฏุงู ุงูุญุฒู)
- **ุงููุตู**: ูุณุจุฉ ุงูุญุฒู ุงูููููุฏุฉ
- **ุงููุญุฏุฉ**: ูุณุจุฉ ูุฆููุฉ (%)
- **ุงููุตุฏุฑ**: `RTCInboundRtpStreamStats.packetsLost / totalPackets`
- **ุงูุนุชุจุงุช**:
  - ููุชุงุฒ: < 1%
  - ุฌูุฏ: < 3%
  - ููุจูู: < 5%
  - ุถุนูู: โฅ 5%

### 3. Jitter (ุงูุชุฐุจุฐุจ)
- **ุงููุตู**: ุชุจุงูู ุฒูู ูุตูู ุงูุญุฒู
- **ุงููุญุฏุฉ**: ูููู ุซุงููุฉ (ms)
- **ุงููุตุฏุฑ**: `RTCInboundRtpStreamStats.jitter`
- **ุงูุนุชุจุงุช**:
  - ููุชุงุฒ: < 30ms
  - ุฌูุฏ: < 50ms
  - ููุจูู: < 100ms
  - ุถุนูู: โฅ 100ms

### 4. Bitrate (ูุนุฏู ุงูุจุช)
- **ุงููุตู**: ุณุฑุนุฉ ููู ุงูุจูุงูุงุช
- **ุงููุญุฏุฉ**: ุจุช ูู ุงูุซุงููุฉ (bps)
- **ุงููุตุฏุฑ**: `(bytesReceived_current - bytesReceived_previous) / timeDiff`
- **ุงูุนุชุจุงุช**:
  - ููุชุงุฒ: > 1 Mbps
  - ุฌูุฏ: > 500 Kbps
  - ููุจูู: > 250 Kbps
  - ุถุนูู: โค 250 Kbps

### 5. FPS (ุงูุฅุทุงุฑุงุช ูู ุงูุซุงููุฉ)
- **ุงููุตู**: ูุนุฏู ุงูุฅุทุงุฑุงุช
- **ุงููุญุฏุฉ**: ุฅุทุงุฑ/ุซุงููุฉ (fps)
- **ุงููุตุฏุฑ**: `RTCInboundRtpStreamStats.framesPerSecond`

### 6. Resolution (ุงูุฏูุฉ)
- **ุงููุตู**: ุฏูุฉ ุงูููุฏูู
- **ุงููุญุฏุฉ**: ุจูุณู (width x height)
- **ุงููุตุฏุฑ**: `RTCInboundRtpStreamStats.frameWidth/frameHeight`

---

## ๐งฎ ุญุณุงุจ ุงูููุงุท

### ุงูุตูุบุฉ ุงูุฅุฌูุงููุฉ

```javascript
overallScore = (
  latencyScore * 0.35 +      // 35% ูุฒู
  packetLossScore * 0.30 +   // 30% ูุฒู
  jitterScore * 0.20 +       // 20% ูุฒู
  bitrateScore * 0.15        // 15% ูุฒู
)
```

### ูุณุชููุงุช ุงูุฌูุฏุฉ

| ุงููุณุชูู | ุงูููุงุท | ุงูุฃููููุฉ | ุงููุตู |
|---------|--------|----------|-------|
| Excellent | 85-100 | ๐ข | ุฌูุฏุฉ ููุชุงุฒุฉุ ูุง ูุดุงูู |
| Good | 70-84 | ๐ก | ุฌูุฏุฉ ุฌูุฏุฉุ ุจุนุถ ุงูุชุญุณููุงุช ููููุฉ |
| Fair | 50-69 | ๐ | ุฌูุฏุฉ ููุจููุฉุ ูุญุชุงุฌ ุชุญุณูู |
| Poor | 0-49 | ๐ด | ุฌูุฏุฉ ุถุนููุฉุ ูุดุงูู ูุจูุฑุฉ |

---

## ๐ป ุงูุงุณุชุฎุฏุงู

### Backend

```javascript
const ConnectionQualityService = require('./services/connectionQualityService');
const service = new ConnectionQualityService();

// ุญุณุงุจ ุงูุฌูุฏุฉ
const stats = {
  latency: 200,
  packetLoss: 1.5,
  jitter: 35,
  bitrate: 900000
};

const quality = service.calculateQuality(stats);
console.log(quality);
// {
//   level: 'good',
//   score: 78,
//   details: { ... },
//   timestamp: Date
// }

// ุงูุญุตูู ุนูู ุชูุตูุงุช
const recommendations = service.getRecommendations(quality);
console.log(recommendations);
// [
//   {
//     type: 'latency',
//     severity: 'medium',
//     message: '...',
//     messageAr: '...'
//   }
// ]

// ุชุญููู ุงูุงุชุฌุงูุงุช
const history = [
  { score: 70 },
  { score: 75 },
  { score: 80 }
];
const trends = service.analyzeTrends(history);
console.log(trends);
// { trend: 'improving', change: 10, average: 75 }
```

### Frontend

```javascript
import ConnectionQualityMonitor from './services/connectionQualityMonitor';
import ConnectionQualityIndicator from './components/VideoInterview/ConnectionQualityIndicator';

// ูู ูููู ุงูููุงุจูุฉ
function VideoInterviewPage() {
  const [peerConnection, setPeerConnection] = useState(null);
  const [qualityMonitor, setQualityMonitor] = useState(null);

  useEffect(() => {
    // ุฅูุดุงุก peer connection
    const pc = new RTCPeerConnection({ ... });
    setPeerConnection(pc);

    // ุฅูุดุงุก monitor
    const monitor = new ConnectionQualityMonitor(pc);
    setQualityMonitor(monitor);

    // ุจุฏุก ุงููุฑุงูุจุฉ (ูู ุซุงููุฉ)
    monitor.start(1000);

    // ุงูุงุณุชูุงุน ููุชุญุฏูุซุงุช
    monitor.addListener((stats) => {
      console.log('Stats updated:', stats);
    });

    return () => {
      monitor.stop();
      pc.close();
    };
  }, []);

  return (
    <div className="video-interview">
      {/* ุนุฑุถ ุงูููุฏูู */}
      <video ref={videoRef} autoPlay />

      {/* ูุคุดุฑ ุงูุฌูุฏุฉ */}
      {qualityMonitor && (
        <ConnectionQualityIndicator 
          qualityMonitor={qualityMonitor}
          language="ar"
        />
      )}
    </div>
  );
}
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุงููุคุดุฑ ุงูุฃุณุงุณู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ข ููุชุงุฒ (92)         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ููุญุฉ ุงูุชูุงุตูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุชูุงุตูู ุงูุงุชุตุงู              [ร]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงูุชุฃุฎูุฑ              150 ms       โ
โ  ููุฏุงู ุงูุญุฒู          1.2%         โ
โ  ุงูุชุฐุจุฐุจ              35 ms        โ
โ  ูุนุฏู ุงูุจุช            1.2 Mbps     โ
โ  ุงูุฅุทุงุฑุงุช/ุซุงููุฉ      30 fps       โ
โ  ุงูุฏูุฉ                1280x720     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุงูุชูุจููุงุช ูุงูุชูุตูุงุช

### ุฃููุงุน ุงูุชูุตูุงุช

1. **High Latency**
   - **ุงูุดุฏุฉ**: ุนุงููุฉ/ูุชูุณุทุฉ
   - **ุงูุฑุณุงูุฉ**: "High latency detected. Try moving closer to your router or using a wired connection."
   - **ุงูุฑุณุงูุฉ ุจุงูุนุฑุจูุฉ**: "ุชุฃุฎูุฑ ุนุงูู ูู ุงูุงุชุตุงู. ุญุงูู ุงูุงูุชุฑุงุจ ูู ุงูุฑุงูุชุฑ ุฃู ุงุณุชุฎุฏุงู ุงุชุตุงู ุณููู."

2. **Packet Loss**
   - **ุงูุดุฏุฉ**: ุนุงููุฉ/ูุชูุณุทุฉ
   - **ุงูุฑุณุงูุฉ**: "Packet loss detected. Check your network connection or close other applications using bandwidth."
   - **ุงูุฑุณุงูุฉ ุจุงูุนุฑุจูุฉ**: "ููุฏุงู ูู ุงูุญุฒู. ุชุญูู ูู ุงุชุตุงู ุงูุดุจูุฉ ุฃู ุฃุบูู ุงูุชุทุจููุงุช ุงูุฃุฎุฑู."

3. **High Jitter**
   - **ุงูุดุฏุฉ**: ุนุงููุฉ/ูุชูุณุทุฉ
   - **ุงูุฑุณุงูุฉ**: "Network instability detected. Try using a more stable connection."
   - **ุงูุฑุณุงูุฉ ุจุงูุนุฑุจูุฉ**: "ุนุฏู ุงุณุชูุฑุงุฑ ูู ุงูุดุจูุฉ. ุญุงูู ุงุณุชุฎุฏุงู ุงุชุตุงู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู."

4. **Low Bitrate**
   - **ุงูุดุฏุฉ**: ุนุงููุฉ/ูุชูุณุทุฉ
   - **ุงูุฑุณุงูุฉ**: "Low bandwidth detected. Consider reducing video quality or closing other applications."
   - **ุงูุฑุณุงูุฉ ุจุงูุนุฑุจูุฉ**: "ูุทุงู ุชุฑุฏุฏู ููุฎูุถ. ููุฑ ูู ุชูููู ุฌูุฏุฉ ุงูููุฏูู."

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

```bash
cd backend
npm test -- connectionQuality.test.js
```

### ุชุบุทูุฉ ุงูุงุฎุชุจุงุฑุงุช

- โ ุญุณุงุจ ุงูุฌูุฏุฉ ูุฌููุน ุงููุณุชููุงุช (excellent, good, fair, poor)
- โ ุงูุชูุงุตูู ุงูุฏูููุฉ ููู ูููุงุณ
- โ ุงูุชูุตูุงุช ุญุณุจ ุงููุดุงูู
- โ ุชุญููู ุงูุงุชุฌุงูุงุช (improving, stable, degrading)
- โ ุงูุญุงูุงุช ุงูุญุฏูุฉ (zero values, very high values, negative values)

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก (KPIs)

### ุงูุฃูุฏุงู

| ุงููุคุดุฑ | ุงููุฏู | ุงูุญุงูุฉ |
|--------|-------|--------|
| ุฌูุฏุฉ ุงูุงุชุตุงู | > 95% ูู ุงูููุงุจูุงุช ุจุฌูุฏุฉ ุฌูุฏุฉ+ | โ |
| ุฒูู ุงูุงูุชูุงู | < 300ms | โ |
| ููุฏุงู ุงูุญุฒู | < 3% | โ |
| ูุนุฏู ุงูุจุช | > 500 Kbps | โ |

### ุงููุฑุงูุจุฉ

- ุชุญุฏูุซ ูู ุซุงููุฉ
- ุชุฎุฒูู ุขุฎุฑ 100 ูุฑุงุกุฉ
- ุชุญููู ุงูุงุชุฌุงูุงุช ูู 10 ูุฑุงุกุงุช

---

## ๐ ุฏุนู ุงููุบุงุช

### ุงููุบุงุช ุงููุฏุนููุฉ

- โ ุงูุนุฑุจูุฉ (ar)
- โ ุงูุฅูุฌููุฒูุฉ (en)

### ุฅุถุงูุฉ ูุบุฉ ุฌุฏูุฏุฉ

```javascript
// ูู ConnectionQualityIndicator.jsx
const getQualityText = (level) => {
  const texts = {
    ar: { excellent: 'ููุชุงุฒ', ... },
    en: { excellent: 'Excellent', ... },
    fr: { excellent: 'Excellent', ... } // ูุบุฉ ุฌุฏูุฏุฉ
  };
  return texts[language][level] || level;
};
```

---

## ๐จ ุงูุชุฎุตูุต

### ุชุบููุฑ ุงูุนุชุจุงุช

```javascript
// ูู connectionQualityService.js
this.thresholds = {
  excellent: {
    latency: 100,      // ุชุบููุฑ ูู 150 ุฅูู 100
    packetLoss: 0.5,   // ุชุบููุฑ ูู 1 ุฅูู 0.5
    jitter: 20,        // ุชุบููุฑ ูู 30 ุฅูู 20
    bitrate: 2000000   // ุชุบููุฑ ูู 1000000 ุฅูู 2000000
  },
  // ...
};
```

### ุชุบููุฑ ุงูุฃูุฒุงู

```javascript
// ูู calculateQuality()
const overallScore = (
  latencyScore * 0.40 +      // ุฒูุงุฏุฉ ูุฒู latency
  packetLossScore * 0.30 +
  jitterScore * 0.20 +
  bitrateScore * 0.10        // ุชูููู ูุฒู bitrate
);
```

### ุชุบููุฑ ูุชุฑุฉ ุงูุชุญุฏูุซ

```javascript
// ุจุฏูุงู ูู ูู ุซุงููุฉ
monitor.start(1000);

// ูู ูุตู ุซุงููุฉ (ุฃูุซุฑ ุฏูุฉุ ุงุณุชููุงู ุฃุนูู)
monitor.start(500);

// ูู ุซุงููุชูู (ุฃูู ุฏูุฉุ ุงุณุชููุงู ุฃูู)
monitor.start(2000);
```

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุฅุญุตุงุฆูุงุช

**ุงูุญู**:
```javascript
// ุชุญูู ูู peer connection
console.log('PC state:', peerConnection.connectionState);

// ุชุญูู ูู monitor
console.log('Monitor running:', monitor.monitoringInterval !== null);

// ุชุญูู ูู ุงูุฅุญุตุงุฆูุงุช
const stats = await peerConnection.getStats();
console.log('Stats:', stats);
```

### ุงููุดููุฉ: ููู ุบูุฑ ุฏูููุฉ

**ุงูุญู**:
```javascript
// ุฒูุงุฏุฉ ูุชุฑุฉ ุงูุชุญุฏูุซ ููุญุตูู ุนูู ููู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู
monitor.start(2000);

// ุฃู ุญุณุงุจ ูุชูุณุท ุขุฎุฑ N ูุฑุงุกุฉ
const averageStats = calculateAverage(lastNReadings);
```

### ุงููุดููุฉ: ุงุณุชููุงู ุนุงูู ููููุงุฑุฏ

**ุงูุญู**:
```javascript
// ุชูููู ุชูุฑุงุฑ ุงูุชุญุฏูุซ
monitor.start(3000);

// ุฅููุงู ุงููุฑุงูุจุฉ ุนูุฏ ุนุฏู ุงูุญุงุฌุฉ
if (!isVideoActive) {
  monitor.stop();
}
```

---

## ๐ ุงููุฑุงุฌุน

- [WebRTC getStats() API](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/getStats)
- [RTCStatsReport](https://developer.mozilla.org/en-US/docs/Web/API/RTCStatsReport)
- [WebRTC Statistics Identifiers](https://www.w3.org/TR/webrtc-stats/)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ูุธุงู ุดุงูู ููุฑุงูุจุฉ ุฌูุฏุฉ ุงูุงุชุตุงู ูู ุงูููุช ุงููุนูู ูุดูู:

- โ ุฌูุน ุฅุญุตุงุฆูุงุช WebRTC (6 ููุงููุณ)
- โ ุญุณุงุจ ูุณุชูู ุงูุฌูุฏุฉ (4 ูุณุชููุงุช)
- โ ุนุฑุถ ูุคุดุฑ ูุฑุฆู (UI component)
- โ ุชูุตูุงุช ุฐููุฉ (4 ุฃููุงุน)
- โ ุชุญููู ุงูุงุชุฌุงูุงุช (improving/stable/degrading)
- โ ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช (ar, en)
- โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ (15+ tests)
- โ ุชูุซูู ูุงูู

**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2026-03-02  
**ุขุฎุฑ ุชุญุฏูุซ**: 2026-03-02
