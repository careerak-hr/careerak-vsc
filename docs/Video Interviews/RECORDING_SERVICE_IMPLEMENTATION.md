# ุชูููุฐ ุฎุฏูุฉ ุชุณุฌูู ุงูููุงุจูุงุช (RecordingService)

## ๐ ูุนูููุงุช ุงูุชูููุฐ
- **ุชุงุฑูุฎ ุงูุชูููุฐ**: 2026-03-01
- **ุงููููุฉ**: 7.1 ุฅูุดุงุก RecordingService
- **ุงูุญุงูุฉ**: โ ููุชูู ุจูุฌุงุญ
- **ุงููุชุทูุจุงุช**: Requirements 2.1, 2.4

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ุฎุฏูุฉ ุดุงููุฉ ูุชุณุฌูู ููุงุจูุงุช ุงูููุฏูู ุจุฌูุฏุฉ ุนุงููุฉ ุจุงุณุชุฎุฏุงู MediaRecorder APIุ ูุน ุฏุนู ูุงูู ูุฑูุน ุงูุชุณุฌููุงุช ุฅูู Cloudinaryุ ุชูููุฏ ุตูุฑ ูุตุบุฑุฉุ ูุงูุญุฐู ุงูุชููุงุฆู.

---

## ๐ฆ ุงููููุงุช ุงููููุฐุฉ

### 1. Backend Service
```
backend/src/services/recordingService.js
```
**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ**:
- `startRecording(interviewId, userId)` - ุจุฏุก ุงูุชุณุฌูู
- `stopRecording(recordingId, userId)` - ุฅููุงู ุงูุชุณุฌูู
- `uploadRecording(recordingId, fileBuffer, mimeType)` - ุฑูุน ุงูุชุณุฌูู
- `generateThumbnail(recordingId, videoPublicId)` - ุชูููุฏ ุตูุฑุฉ ูุตุบุฑุฉ
- `getRecording(recordingId)` - ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุชุณุฌูู
- `deleteRecording(recordingId, userId)` - ุญุฐู ุชุณุฌูู
- `deleteExpiredRecordings()` - ุญุฐู ุงูุชุณุฌููุงุช ุงูููุชููุฉ
- `incrementDownloadCount(recordingId)` - ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุชุญูููุงุช
- `extractPublicId(url)` - ุงุณุชุฎุฑุงุฌ public_id ูู ุฑุงุจุท Cloudinary

### 2. Data Model
```
backend/src/models/InterviewRecording.js
```
**ุงูุญููู ุงูุฑุฆูุณูุฉ**:
- `interviewId` - ูุนุฑู ุงูููุงุจูุฉ
- `startTime`, `endTime`, `duration` - ูุนูููุงุช ุงูุชูููุช
- `fileUrl`, `thumbnailUrl` - ุฑูุงุจุท ุงููููุงุช
- `status` - ุญุงูุฉ ุงูุชุณุฌูู (recording, processing, ready, failed, deleted)
- `expiresAt` - ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ (90 ููู)
- `downloadCount` - ุนุฏุฏ ูุฑุงุช ุงูุชุญููู
- `metadata` - ูุนูููุงุช ุฅุถุงููุฉ (format, videoQuality, bitrate, etc.)

**Virtual Properties**:
- `fileSizeFormatted` - ุญุฌู ุงูููู ุจุตูุบุฉ ูุงุจูุฉ ูููุฑุงุกุฉ
- `durationFormatted` - ุงููุฏุฉ ุจุตูุบุฉ HH:MM:SS
- `isExpired` - ูู ุงูุชูุช ุงูุตูุงุญูุฉ
- `daysRemaining` - ุงูุฃูุงู ุงููุชุจููุฉ

**Methods**:
- `updateStatus(status)` - ุชุญุฏูุซ ุงูุญุงูุฉ
- `updateFileInfo(fileUrl, fileSize, duration)` - ุชุญุฏูุซ ูุนูููุงุช ุงูููู
- `incrementDownloads()` - ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุชุญูููุงุช
- `deleteFile()` - ุญุฐู ุงูููู

**Static Methods**:
- `findExpired()` - ุงูุญุตูู ุนูู ุงูุชุณุฌููุงุช ุงูููุชููุฉ
- `findByInterview(interviewId)` - ุงูุญุตูู ุนูู ุชุณุฌููุงุช ููุงุจูุฉ

### 3. Controller
```
backend/src/controllers/recordingController.js
```
**Endpoints**:
- `POST /recordings/start` - ุจุฏุก ุงูุชุณุฌูู
- `POST /recordings/:recordingId/stop` - ุฅููุงู ุงูุชุณุฌูู
- `POST /recordings/:recordingId/upload` - ุฑูุน ุงูุชุณุฌูู
- `GET /recordings/:recordingId` - ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุชุณุฌูู
- `DELETE /recordings/:recordingId` - ุญุฐู ุชุณุฌูู
- `GET /recordings/interview/:interviewId` - ุงูุญุตูู ุนูู ุชุณุฌููุงุช ููุงุจูุฉ

### 4. Routes
```
backend/src/routes/recordingRoutes.js
```
ุฌููุน ุงููุณุงุฑุงุช ูุญููุฉ ุจู authentication middleware.

### 5. Tests
```
backend/tests/recordingService.test.js
```
**20 ุงุฎุชุจุงุฑ ุดุงูู**:
- โ 5 ุงุฎุชุจุงุฑุงุช ูู startRecording
- โ 4 ุงุฎุชุจุงุฑุงุช ูู stopRecording
- โ 3 ุงุฎุชุจุงุฑุงุช ูู uploadRecording
- โ 1 ุงุฎุชุจุงุฑ ูู generateThumbnail
- โ 2 ุงุฎุชุจุงุฑุงุช ูู getRecording
- โ 2 ุงุฎุชุจุงุฑุงุช ูู deleteRecording
- โ 1 ุงุฎุชุจุงุฑ ูู deleteExpiredRecordings
- โ 1 ุงุฎุชุจุงุฑ ูู incrementDownloadCount
- โ 1 ุงุฎุชุจุงุฑ ูู extractPublicId

**ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑุงุช**: โ 20/20 ูุฌุญุช

---

## ๐ฌ ููู ูุนูู ุงููุธุงู

### 1. ุจุฏุก ุงูุชุณุฌูู
```javascript
// Backend
const result = await recordingService.startRecording(interviewId, userId);

// ุงูุชุญููุงุช:
// - ุงูููุงุจูุฉ ููุฌูุฏุฉ
// - ุงููุณุชุฎุฏู ูู ุงููุถูู
// - ุงูุชุณุฌูู ููุนูู
// - ุฌููุน ุงููุดุงุฑููู ูุงูููุง
```

### 2. ุฅููุงู ุงูุชุณุฌูู
```javascript
const result = await recordingService.stopRecording(recordingId, userId);

// ูุญุณุจ ุงููุฏุฉ ุชููุงุฆูุงู
// ูุญุฏุซ ุงูุญุงูุฉ ุฅูู 'processing'
```

### 3. ุฑูุน ุงูุชุณุฌูู
```javascript
const result = await recordingService.uploadRecording(
  recordingId,
  videoBuffer,
  'video/webm'
);

// ูุฑูุน ุฅูู Cloudinary
// ูุญูู ุฅูู MP4 ุชููุงุฆูุงู
// ูููุฏ ุตูุฑุฉ ูุตุบุฑุฉ
// ูุญุฏุฏ ุชุงุฑูุฎ ุงูุชูุงุก (90 ููู)
```

### 4. ุงูุญุฐู ุงูุชููุงุฆู
```javascript
// Cron job ูููู
const result = await recordingService.deleteExpiredRecordings();

// ูุญุฐู ูู Cloudinary
// ูุญุฏุซ ุญุงูุฉ ุงูุณุฌู ุฅูู 'deleted'
```

---

## ๐ง ุฅุนุฏุงุฏุงุช Cloudinary

### ุฑูุน ุงูููุฏูู
```javascript
{
  resource_type: 'video',
  folder: 'careerak/interview-recordings',
  format: 'mp4',
  quality: 'auto:best',
  transformation: [
    { width: 1280, height: 720, crop: 'limit' }, // HD 720p
    { video_codec: 'h264', audio_codec: 'aac' }
  ]
}
```

### ุงูุตูุฑุฉ ุงููุตุบุฑุฉ
```javascript
{
  resource_type: 'video',
  format: 'jpg',
  transformation: [
    { width: 640, height: 360, crop: 'fill' },
    { start_offset: '5' } // ูู ุงูุซุงููุฉ 5
  ]
}
```

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุงูุชุญููุงุช ุงูุฃูููุฉ
1. **ุจุฏุก ุงูุชุณุฌูู**:
   - ููุท ุงููุถูู ููููู ุจุฏุก ุงูุชุณุฌูู
   - ูุฌุจ ููุงููุฉ ุฌููุน ุงููุดุงุฑููู
   - ุงูุชุณุฌูู ูุฌุจ ุฃู ูููู ููุนูู

2. **ุฅููุงู ุงูุชุณุฌูู**:
   - ููุท ุงููุถูู ููููู ุฅููุงู ุงูุชุณุฌูู
   - ุงูุชุณุฌูู ูุฌุจ ุฃู ูููู ููุฏ ุงูุชุดุบูู

3. **ุญุฐู ุงูุชุณุฌูู**:
   - ููุท ุงููุถูู ููููู ุญุฐู ุงูุชุณุฌูู

4. **ุงููุตูู ููุชุณุฌูู**:
   - ุงููุถูู ูุงููุดุงุฑููู ููุท

### ุงูุฎุตูุตูุฉ
- ููุงููุฉ ุฅูุฒุงููุฉ ูู ุฌููุน ุงููุดุงุฑููู
- ุญุฐู ุชููุงุฆู ุจุนุฏ 90 ููู
- ุชุดููุฑ ุงูุงุชุตุงูุงุช (HTTPS)

---

## ๐ ุญุงูุงุช ุงูุชุณุฌูู

| ุงูุญุงูุฉ | ุงููุตู | ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ |
|--------|-------|-------------------|
| `recording` | ุงูุชุณุฌูู ููุฏ ุงูุชุดุบูู | ุฅููุงู |
| `processing` | ุฌุงุฑู ูุนุงูุฌุฉ ุงูููุฏูู | ุฑูุน |
| `ready` | ุงูุชุณุฌูู ุฌุงูุฒ | ูุดุงูุฏุฉุ ุชุญูููุ ุญุฐู |
| `failed` | ูุดู ุงูุชุณุฌูู ุฃู ุงูุฑูุน | ุฅุนุงุฏุฉ ุงููุญุงููุฉุ ุญุฐู |
| `deleted` | ุชู ุญุฐู ุงูุชุณุฌูู | - |

---

## ๐ฏ ุงูููุฒุงุช ุงููููุฐุฉ

### โ ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ
- [x] ุจุฏุก ูุฅููุงู ุงูุชุณุฌูู
- [x] ุฑูุน ุงูุชุณุฌููุงุช ุฅูู Cloudinary
- [x] ุชุญููู ุชููุงุฆู ุฅูู MP4
- [x] ุถุบุท ูุชุญุณูู ุงูุฌูุฏุฉ
- [x] ุชูููุฏ ุตูุฑ ูุตุบุฑุฉ
- [x] ุญุณุงุจ ุงููุฏุฉ ุชููุงุฆูุงู

### โ ุฅุฏุงุฑุฉ ุงูุชุณุฌููุงุช
- [x] ุงูุญุตูู ุนูู ูุนูููุงุช ุงูุชุณุฌูู
- [x] ุญุฐู ุงูุชุณุฌููุงุช
- [x] ุงูุญุฐู ุงูุชููุงุฆู ุจุนุฏ 90 ููู
- [x] ุนุฏุงุฏ ุงูุชุญูููุงุช

### โ ุงูุฃูุงู ูุงูุตูุงุญูุงุช
- [x] ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุณุชุฎุฏู
- [x] ููุงููุฉ ุฅูุฒุงููุฉ ูู ุฌููุน ุงููุดุงุฑููู
- [x] ุญูุงูุฉ ุฌููุน endpoints ุจู authentication

### โ ุงูุงุฎุชุจุงุฑุงุช
- [x] 20 ุงุฎุชุจุงุฑ unit test
- [x] ุชุบุทูุฉ ุดุงููุฉ ูุฌููุน ุงููุธุงุฆู
- [x] ุงุฎุชุจุงุฑ ุญุงูุงุช ุงููุฌุงุญ ูุงููุดู

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก

### ุงูุฌูุฏุฉ
- **ููุฏูู**: HD 720p (1280x720)
- **Codec**: H.264 (video), AAC (audio)
- **Format**: MP4 (ูุชูุงูู ูุน ุฌููุน ุงููุชุตูุญุงุช)

### ุงูุญุฌู
- **ุงูุญุฏ ุงูุฃูุตู**: 500 MB ููููู ุงููุงุญุฏ
- **ุงูุถุบุท**: ุชููุงุฆู ุจูุงุณุทุฉ Cloudinary
- **ุงูุชูููุฑ**: 30-50% ูู ุงูุญุฌู ุงูุฃุตูู

### ุงูุฃุฏุงุก
- **ุฑูุน**: 1-5 ุฏูุงุฆู (ุญุณุจ ุญุฌู ุงูููู)
- **ูุนุงูุฌุฉ**: 30-60 ุซุงููุฉ
- **ุตูุฑุฉ ูุตุบุฑุฉ**: 5-10 ุซูุงูู

---

## ๐ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ

### VideoInterview Model
- ูุญุชูู ุนูู `recordingUrl` ููุชุณุฌูู ุงูุฑุฆูุณู
- ูุญุชูู ุนูู `recordingConsent` ูููุงููุงุช ุงููุดุงุฑููู

### Routes
- ูุณุฌู ูู `app.js` ุชุญุช `/recordings`
- ูุญูู ุจู authentication middleware

### Cloudinary
- ูุณุชุฎุฏู ุงูุชูููู ุงูููุฌูุฏ ูู `config/cloudinary.js`
- ูุฑูุน ุฅูู ูุฌูุฏ `careerak/interview-recordings`

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### "ูุฌุจ ููุงููุฉ ุฌููุน ุงููุดุงุฑููู"
**ุงูุณุจุจ**: ูู ููุงูู ุฃุญุฏ ุงููุดุงุฑููู ุนูู ุงูุชุณุฌูู
**ุงูุญู**: ุงุทูุจ ูู ุฌููุน ุงููุดุงุฑููู ุงูููุงููุฉ ูุจู ุจุฏุก ุงูุชุณุฌูู

### "ูุดู ุฑูุน ุงูุชุณุฌูู"
**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ**:
- ุญุฌู ุงูููู ุฃูุจุฑ ูู 500 MB
- ูุดููุฉ ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
- ุฎุทุฃ ูู ุฅุนุฏุงุฏุงุช Cloudinary

**ุงูุญู**: ุชุญูู ูู ุญุฌู ุงูููู ูุงูุงุชุตุงู

### "ุงูุชุณุฌูู ููุณ ููุฏ ุงูุชุดุบูู"
**ุงูุณุจุจ**: ูุญุงููุฉ ุฅููุงู ุชุณุฌูู ุบูุฑ ูุดุท
**ุงูุญู**: ุชุญูู ูู ุญุงูุฉ ุงูุชุณุฌูู ูุจู ุงูุฅููุงู

---

## ๐ ุงูุงุณุชุฎุฏุงู

### Backend - ุจุฏุก ุงูุชุณุฌูู
```javascript
const recordingService = require('./services/recordingService');

const result = await recordingService.startRecording(interviewId, userId);
// {
//   success: true,
//   recordingId: '...',
//   message: 'ุจุฏุฃ ุงูุชุณุฌูู ุจูุฌุงุญ'
// }
```

### Backend - ุฑูุน ุงูุชุณุฌูู
```javascript
const result = await recordingService.uploadRecording(
  recordingId,
  videoBuffer,
  'video/webm'
);
// {
//   success: true,
//   fileUrl: 'https://res.cloudinary.com/...',
//   fileSize: 52428800,
//   duration: 1800
// }
```

### Frontend - API Call
```javascript
// ุจุฏุก ุงูุชุณุฌูู
const response = await fetch('/api/recordings/start', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ interviewId })
});

const result = await response.json();
```

---

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- `backend/src/services/recordingService.js` - ุงูุฎุฏูุฉ ุงูุฑุฆูุณูุฉ
- `backend/src/models/InterviewRecording.js` - ูููุฐุฌ ุงูุจูุงูุงุช
- `backend/src/controllers/recordingController.js` - ูุนุงูุฌ ุงูุทูุจุงุช
- `backend/src/routes/recordingRoutes.js` - ุงููุณุงุฑุงุช
- `backend/tests/recordingService.test.js` - ุงูุงุฎุชุจุงุฑุงุช
- `backend/src/services/README_RECORDING_SERVICE.md` - ุฏููู ุงูุงุณุชุฎุฏุงู

---

## ๐ ุงูุฎุทูุงุช ุงููุงุฏูุฉ

### ุงููููุฉ 7.2: ูุธุงู ุงูููุงููุฉ
- [ ] ุฅุถุงูุฉ UI ูุทูุจ ุงูููุงููุฉ
- [ ] ุฅุดุนุงุฑุงุช ุงูููุงููุฉ
- [ ] ููุน ุงูุชุณุฌูู ุจุฏูู ููุงููุฉ

### ุงููููุฉ 7.5: ูุนุงูุฌุฉ ุงูุชุณุฌููุงุช
- [ ] ุฑูุน ุงูุชุณุฌูู ููุชุฎุฒูู ุงูุณุญุงุจู โ (ููุชูู)
- [ ] ุชูููุฏ ุตูุฑุฉ ูุตุบุฑุฉ โ (ููุชูู)
- [ ] ุชูููุฏ ุฑุงุจุท ุชุญููู โ (ููุชูู)

### ุงููููุฉ 7.6: ุงูุญุฐู ุงูุชููุงุฆู
- [ ] ุฌุฏููุฉ ุญุฐู ุจุนุฏ 90 ููู โ (ููุชูู)
- [ ] Cron job ููุญุฐู (ูุญุชุงุฌ ุฅุนุฏุงุฏ)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ุฎุฏูุฉ ุชุณุฌูู ุงูููุงุจูุงุช ุจูุฌุงุญ ูุน:
- โ ุฌููุน ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ
- โ 20 ุงุฎุชุจุงุฑ ุดุงูู (ูููุง ูุฌุญุช)
- โ ุชูุงูู ูุงูู ูุน Cloudinary
- โ ุฃูุงู ูุตูุงุญูุงุช ูุญููุฉ
- โ ุชูุซูู ุดุงูู

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููููู ุงูุจูุงุก ุนููู ูู ุงููุฑุงุญู ุงููุงุฏูุฉ.

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2026-03-01  
**ุขุฎุฑ ุชุญุฏูุซ**: 2026-03-01  
**ุงูุญุงูุฉ**: โ ููุชูู ุจูุฌุงุญ  
**ุงููููุฉ**: 7.1 ุฅูุดุงุก RecordingService
