{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useRef}from\"react\";import{Preferences}from\"@capacitor/preferences\";import{App}from\"@capacitor/app\";import CryptoJS from'crypto-js';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const SECRET_KEY='careerak_secure_key_2024';export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[language,setLanguage]=useState(null);const[audioEnabled,setAudioEnabled]=useState(null);const[canStartMusic,setCanStartMusic]=useState(false);// مفتاح بدء موسيقى الخلفية\nconst[loading,setLoading]=useState(true);const audioRef=useRef(null);useEffect(()=>{const loadPrefs=async()=>{try{const{value:lang}=await Preferences.get({key:\"lang\"});const{value:audio}=await Preferences.get({key:\"audio_enabled\"});const{value:encryptedToken}=await Preferences.get({key:\"auth_token\"});const savedUser=localStorage.getItem('user');if(lang){setLanguage(lang);document.documentElement.lang=lang;document.documentElement.dir=lang===\"ar\"?\"rtl\":\"ltr\";}if(encryptedToken){try{const bytes=CryptoJS.AES.decrypt(encryptedToken,SECRET_KEY);const originalToken=bytes.toString(CryptoJS.enc.Utf8);if(originalToken)setToken(originalToken);}catch(e){console.error(\"Token decryption failed\",e);}}if(savedUser){setUser(JSON.parse(savedUser));}// افتراضياً نعتبر الصوت مفعلاً مالم يتم حفظ العكس\nsetAudioEnabled(audio===null?true:audio===\"true\");}catch(error){console.error(\"Error loading prefs\",error);}finally{setLoading(false);}};loadPrefs();},[]);// إدارة الموسيقى العالمية (Music.mp3)\nuseEffect(()=>{// الموسيقى تعمل فقط إذا كان الصوت مفعلاً وتم إعطاء الإشارة بالبدء (من صفحة تسجيل الدخول)\nif(audioEnabled&&canStartMusic&&!loading){if(!audioRef.current){audioRef.current=new Audio('/Music.mp3');audioRef.current.loop=true;audioRef.current.volume=0.4;}audioRef.current.play().catch(e=>console.log(\"Background music play failed:\",e));}else if(audioRef.current){audioRef.current.pause();}// مراقبة حالة التطبيق (Home, Lock, Background) لإيقاف الموسيقى فوراً\nconst handleAppState=state=>{if(!audioRef.current||!audioEnabled||!canStartMusic)return;if(state.isActive){audioRef.current.play().catch(()=>{});}else{audioRef.current.pause();}};const listener=App.addListener('appStateChange',handleAppState);return()=>{listener.then(l=>l.remove());};},[audioEnabled,canStartMusic,loading]);const login=async(userData,rawToken)=>{const encryptedToken=CryptoJS.AES.encrypt(rawToken,SECRET_KEY).toString();await Preferences.set({key:'auth_token',value:encryptedToken});localStorage.setItem('user',JSON.stringify(userData));setUser(userData);setToken(rawToken);setCanStartMusic(true);// تفعيل الموسيقى عند تسجيل الدخول\n};const startBgMusic=()=>{setCanStartMusic(true);};const stopBgMusic=()=>{setCanStartMusic(false);};const updateUser=userData=>{localStorage.setItem('user',JSON.stringify(userData));setUser(userData);};const logout=async()=>{await Preferences.remove({key:'auth_token'});localStorage.removeItem('user');setUser(null);setToken(null);setCanStartMusic(false);};const changeLanguage=async lang=>{await Preferences.set({key:\"lang\",value:lang});setLanguage(lang);document.documentElement.lang=lang;document.documentElement.dir=lang===\"ar\"?\"rtl\":\"ltr\";};const setAudio=async enabled=>{await Preferences.set({key:\"audio_enabled\",value:enabled?\"true\":\"false\"});setAudioEnabled(enabled);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,language,audioEnabled,loading,login,updateUser,logout,changeLanguage,setAudio,startBgMusic,// دالة لبدء موسيقى الخلفية\nstopBgMusic// دالة لإيقاف موسيقى الخلفية\n},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useRef","Preferences","App","CryptoJS","jsx","_jsx","AuthContext","SECRET_KEY","AuthProvider","_ref","children","user","setUser","token","setToken","language","setLanguage","audioEnabled","setAudioEnabled","canStartMusic","setCanStartMusic","loading","setLoading","audioRef","loadPrefs","value","lang","get","key","audio","encryptedToken","savedUser","localStorage","getItem","document","documentElement","dir","bytes","AES","decrypt","originalToken","toString","enc","Utf8","e","console","error","JSON","parse","current","Audio","loop","volume","play","catch","log","pause","handleAppState","state","isActive","listener","addListener","then","l","remove","login","userData","rawToken","encrypt","set","setItem","stringify","startBgMusic","stopBgMusic","updateUser","logout","removeItem","changeLanguage","setAudio","enabled","Provider","useAuth"],"sources":["D:/Careerak/Careerak-vsc/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useRef } from \"react\";\r\nimport { Preferences } from \"@capacitor/preferences\";\r\nimport { App } from \"@capacitor/app\";\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst AuthContext = createContext();\r\nconst SECRET_KEY = 'careerak_secure_key_2024';\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [language, setLanguage] = useState(null);\r\n  const [audioEnabled, setAudioEnabled] = useState(null);\r\n  const [canStartMusic, setCanStartMusic] = useState(false); // مفتاح بدء موسيقى الخلفية\r\n  const [loading, setLoading] = useState(true);\r\n  const audioRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const loadPrefs = async () => {\r\n      try {\r\n        const { value: lang } = await Preferences.get({ key: \"lang\" });\r\n        const { value: audio } = await Preferences.get({ key: \"audio_enabled\" });\r\n        const { value: encryptedToken } = await Preferences.get({ key: \"auth_token\" });\r\n        const savedUser = localStorage.getItem('user');\r\n\r\n        if (lang) {\r\n          setLanguage(lang);\r\n          document.documentElement.lang = lang;\r\n          document.documentElement.dir = lang === \"ar\" ? \"rtl\" : \"ltr\";\r\n        }\r\n\r\n        if (encryptedToken) {\r\n          try {\r\n            const bytes = CryptoJS.AES.decrypt(encryptedToken, SECRET_KEY);\r\n            const originalToken = bytes.toString(CryptoJS.enc.Utf8);\r\n            if (originalToken) setToken(originalToken);\r\n          } catch (e) {\r\n            console.error(\"Token decryption failed\", e);\r\n          }\r\n        }\r\n\r\n        if (savedUser) {\r\n          setUser(JSON.parse(savedUser));\r\n        }\r\n\r\n        // افتراضياً نعتبر الصوت مفعلاً مالم يتم حفظ العكس\r\n        setAudioEnabled(audio === null ? true : audio === \"true\");\r\n      } catch (error) {\r\n        console.error(\"Error loading prefs\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadPrefs();\r\n  }, []);\r\n\r\n  // إدارة الموسيقى العالمية (Music.mp3)\r\n  useEffect(() => {\r\n    // الموسيقى تعمل فقط إذا كان الصوت مفعلاً وتم إعطاء الإشارة بالبدء (من صفحة تسجيل الدخول)\r\n    if (audioEnabled && canStartMusic && !loading) {\r\n      if (!audioRef.current) {\r\n        audioRef.current = new Audio('/Music.mp3');\r\n        audioRef.current.loop = true;\r\n        audioRef.current.volume = 0.4;\r\n      }\r\n      audioRef.current.play().catch(e => console.log(\"Background music play failed:\", e));\r\n    } else if (audioRef.current) {\r\n      audioRef.current.pause();\r\n    }\r\n\r\n    // مراقبة حالة التطبيق (Home, Lock, Background) لإيقاف الموسيقى فوراً\r\n    const handleAppState = (state) => {\r\n      if (!audioRef.current || !audioEnabled || !canStartMusic) return;\r\n      if (state.isActive) {\r\n        audioRef.current.play().catch(() => {});\r\n      } else {\r\n        audioRef.current.pause();\r\n      }\r\n    };\r\n\r\n    const listener = App.addListener('appStateChange', handleAppState);\r\n    \r\n    return () => {\r\n      listener.then(l => l.remove());\r\n    };\r\n  }, [audioEnabled, canStartMusic, loading]);\r\n\r\n  const login = async (userData, rawToken) => {\r\n    const encryptedToken = CryptoJS.AES.encrypt(rawToken, SECRET_KEY).toString();\r\n    await Preferences.set({ key: 'auth_token', value: encryptedToken });\r\n    localStorage.setItem('user', JSON.stringify(userData));\r\n    setUser(userData);\r\n    setToken(rawToken);\r\n    setCanStartMusic(true); // تفعيل الموسيقى عند تسجيل الدخول\r\n  };\r\n\r\n  const startBgMusic = () => {\r\n    setCanStartMusic(true);\r\n  };\r\n\r\n  const stopBgMusic = () => {\r\n    setCanStartMusic(false);\r\n  };\r\n\r\n  const updateUser = (userData) => {\r\n    localStorage.setItem('user', JSON.stringify(userData));\r\n    setUser(userData);\r\n  };\r\n\r\n  const logout = async () => {\r\n    await Preferences.remove({ key: 'auth_token' });\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n    setToken(null);\r\n    setCanStartMusic(false);\r\n  };\r\n\r\n  const changeLanguage = async (lang) => {\r\n    await Preferences.set({ key: \"lang\", value: lang });\r\n    setLanguage(lang);\r\n    document.documentElement.lang = lang;\r\n    document.documentElement.dir = lang === \"ar\" ? \"rtl\" : \"ltr\";\r\n  };\r\n\r\n  const setAudio = async (enabled) => {\r\n    await Preferences.set({\r\n      key: \"audio_enabled\",\r\n      value: enabled ? \"true\" : \"false\",\r\n    });\r\n    setAudioEnabled(enabled);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        token,\r\n        language,\r\n        audioEnabled,\r\n        loading,\r\n        login,\r\n        updateUser,\r\n        logout,\r\n        changeLanguage,\r\n        setAudio,\r\n        startBgMusic, // دالة لبدء موسيقى الخلفية\r\n        stopBgMusic  // دالة لإيقاف موسيقى الخلفية\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}