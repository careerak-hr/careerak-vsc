{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{userService}from'../services/api';import{Preferences}from'@capacitor/preferences';import{App}from'@capacitor/app';import{useAuth}from'../context/AuthContext';import CryptoJS from'crypto-js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SECRET_KEY='careerak_secure_key_2024';const loginTranslations={ar:{subtitle:\"تسجيل الدخول\",userPlaceholder:\"البريد الإلكتروني أو اسم المستخدم\",passPlaceholder:\"كلمة المرور\",loginBtn:\"دخول\",noAccount:\"ليس لديك حساب؟\",createAccount:\"أنشئ حساباً الآن\",error:\"فشل الدخول، تحقق من البيانات\"},en:{subtitle:\"Login\",userPlaceholder:\"Email or Username\",passPlaceholder:\"Password\",loginBtn:\"Login\",noAccount:\"Don't have an account?\",createAccount:\"Create account now\",error:\"Login failed, please check your credentials\"},fr:{subtitle:\"Connexion\",userPlaceholder:\"Email ou nom d'utilisateur\",passPlaceholder:\"Mot de passe\",loginBtn:\"Entrer\",noAccount:\"Pas de compte ?\",createAccount:\"Créer un compte\",error:\"Échec de la connexion, vérifiez vos identifiants\"}};export default function LoginPage(){const navigate=useNavigate();const{language}=useAuth();const t=loginTranslations[language]||loginTranslations.ar;const isRTL=language==='ar';const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[isVisible,setIsVisible]=useState(false);useEffect(()=>{setIsVisible(true);// معالجة زر الرجوع في الهاتف\nconst backButtonListener=App.addListener('backButton',()=>{// بما أننا في صفحة تسجيل الدخول، نخرج من التطبيق نهائياً حسب الطلب\nApp.exitApp();});return()=>{backButtonListener.then(l=>l.remove());};},[]);const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{var _response$data$user$r;const response=await userService.login({email,password});const encryptedToken=CryptoJS.AES.encrypt(response.data.token,SECRET_KEY).toString();await Preferences.set({key:'auth_token',value:encryptedToken});localStorage.setItem('user',JSON.stringify(response.data.user));const role=(_response$data$user$r=response.data.user.role)===null||_response$data$user$r===void 0?void 0:_response$data$user$r.toLowerCase();// التوجيه التلقائي حسب نوع الحساب (دستور كاريرك - البند 3)\nif(role==='admin')navigate('/admin-dashboard');else if(role==='hr')navigate('/onboarding-companies');// أو لوحة تحكم الـ HR\nelse navigate('/profile');}catch(err){setError(t.error);}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#E3DAD0] transition-opacity duration-1000 \".concat(isVisible?'opacity-100':'opacity-0'),dir:isRTL?'rtl':'ltr',children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-sm bg-white rounded-[3.5rem] shadow-2xl p-10 mx-4 relative overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-24 h-24 rounded-full border-4 border-[#1A365D] p-1 mb-4 shadow-xl overflow-hidden\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/logo.jpg\",alt:\"Logo\",className:\"w-full h-full object-cover rounded-full\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-black text-[#1A365D] italic\",children:\"Careerak\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400 font-bold text-sm mt-1\",children:t.subtitle})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 text-red-600 p-3 rounded-xl text-xs font-bold mb-4 text-center border border-red-100\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:t.userPlaceholder,className:\"w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 focus:border-[#1A365D]/20 outline-none font-bold text-center transition-all placeholder:text-gray-300\",value:email,onChange:e=>setEmail(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:t.passPlaceholder,className:\"w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 focus:border-[#1A365D]/20 outline-none font-bold text-center transition-all placeholder:text-gray-300\",value:password,onChange:e=>setPassword(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-[#1A365D] text-white p-6 rounded-[2rem] font-black text-xl shadow-xl active:scale-95 transition-all mt-4\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto\"}):t.loginBtn})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-8 text-center\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs font-bold text-gray-400\",children:[t.noAccount,\" \",/*#__PURE__*/_jsx(\"span\",{onClick:()=>navigate('/auth'),className:\"text-[#1A365D] cursor-pointer hover:underline\",children:t.createAccount})]})})]})});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","userService","Preferences","App","useAuth","CryptoJS","jsx","_jsx","jsxs","_jsxs","SECRET_KEY","loginTranslations","ar","subtitle","userPlaceholder","passPlaceholder","loginBtn","noAccount","createAccount","error","en","fr","LoginPage","navigate","language","t","isRTL","email","setEmail","password","setPassword","loading","setLoading","setError","isVisible","setIsVisible","backButtonListener","addListener","exitApp","then","l","remove","handleSubmit","e","preventDefault","_response$data$user$r","response","login","encryptedToken","AES","encrypt","data","token","toString","set","key","value","localStorage","setItem","JSON","stringify","user","role","toLowerCase","err","className","concat","dir","children","src","alt","onSubmit","type","placeholder","onChange","target","required","disabled","onClick"],"sources":["D:/Careerak/Careerak-vsc/frontend/src/pages/03_LoginPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { userService } from '../services/api';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport { App } from '@capacitor/app';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst SECRET_KEY = 'careerak_secure_key_2024';\r\n\r\nconst loginTranslations = {\r\n  ar: {\r\n    subtitle: \"تسجيل الدخول\",\r\n    userPlaceholder: \"البريد الإلكتروني أو اسم المستخدم\",\r\n    passPlaceholder: \"كلمة المرور\",\r\n    loginBtn: \"دخول\",\r\n    noAccount: \"ليس لديك حساب؟\",\r\n    createAccount: \"أنشئ حساباً الآن\",\r\n    error: \"فشل الدخول، تحقق من البيانات\"\r\n  },\r\n  en: {\r\n    subtitle: \"Login\",\r\n    userPlaceholder: \"Email or Username\",\r\n    passPlaceholder: \"Password\",\r\n    loginBtn: \"Login\",\r\n    noAccount: \"Don't have an account?\",\r\n    createAccount: \"Create account now\",\r\n    error: \"Login failed, please check your credentials\"\r\n  },\r\n  fr: {\r\n    subtitle: \"Connexion\",\r\n    userPlaceholder: \"Email ou nom d'utilisateur\",\r\n    passPlaceholder: \"Mot de passe\",\r\n    loginBtn: \"Entrer\",\r\n    noAccount: \"Pas de compte ?\",\r\n    createAccount: \"Créer un compte\",\r\n    error: \"Échec de la connexion, vérifiez vos identifiants\"\r\n  }\r\n};\r\n\r\nexport default function LoginPage() {\r\n  const navigate = useNavigate();\r\n  const { language } = useAuth();\r\n  const t = loginTranslations[language] || loginTranslations.ar;\r\n  const isRTL = language === 'ar';\r\n\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setIsVisible(true);\r\n\r\n    // معالجة زر الرجوع في الهاتف\r\n    const backButtonListener = App.addListener('backButton', () => {\r\n      // بما أننا في صفحة تسجيل الدخول، نخرج من التطبيق نهائياً حسب الطلب\r\n      App.exitApp();\r\n    });\r\n\r\n    return () => {\r\n      backButtonListener.then(l => l.remove());\r\n    };\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const response = await userService.login({ email, password });\r\n      const encryptedToken = CryptoJS.AES.encrypt(response.data.token, SECRET_KEY).toString();\r\n      await Preferences.set({ key: 'auth_token', value: encryptedToken });\r\n      localStorage.setItem('user', JSON.stringify(response.data.user));\r\n      \r\n      const role = response.data.user.role?.toLowerCase();\r\n      // التوجيه التلقائي حسب نوع الحساب (دستور كاريرك - البند 3)\r\n      if (role === 'admin') navigate('/admin-dashboard');\r\n      else if (role === 'hr') navigate('/onboarding-companies'); // أو لوحة تحكم الـ HR\r\n      else navigate('/profile');\r\n    } catch (err) {\r\n      setError(t.error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`min-h-screen flex items-center justify-center bg-[#E3DAD0] transition-opacity duration-1000 ${isVisible ? 'opacity-100' : 'opacity-0'}`} dir={isRTL ? 'rtl' : 'ltr'}>\r\n      <div className=\"w-full max-w-sm bg-white rounded-[3.5rem] shadow-2xl p-10 mx-4 relative overflow-hidden\">\r\n        \r\n        <div className=\"flex flex-col items-center mb-8\">\r\n          <div className=\"w-24 h-24 rounded-full border-4 border-[#1A365D] p-1 mb-4 shadow-xl overflow-hidden\">\r\n             <img src=\"/logo.jpg\" alt=\"Logo\" className=\"w-full h-full object-cover rounded-full\" />\r\n          </div>\r\n          <h1 className=\"text-3xl font-black text-[#1A365D] italic\">Careerak</h1>\r\n          <p className=\"text-gray-400 font-bold text-sm mt-1\">{t.subtitle}</p>\r\n        </div>\r\n\r\n        {error && <div className=\"bg-red-50 text-red-600 p-3 rounded-xl text-xs font-bold mb-4 text-center border border-red-100\">{error}</div>}\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder={t.userPlaceholder}\r\n              className=\"w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 focus:border-[#1A365D]/20 outline-none font-bold text-center transition-all placeholder:text-gray-300\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n          <div className=\"relative\">\r\n            <input\r\n              type=\"password\"\r\n              placeholder={t.passPlaceholder}\r\n              className=\"w-full p-5 bg-gray-50 rounded-2xl border-2 border-gray-100 focus:border-[#1A365D]/20 outline-none font-bold text-center transition-all placeholder:text-gray-300\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className=\"w-full bg-[#1A365D] text-white p-6 rounded-[2rem] font-black text-xl shadow-xl active:scale-95 transition-all mt-4\"\r\n          >\r\n            {loading ? <div className=\"w-6 h-6 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto\"></div> : t.loginBtn}\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"mt-8 text-center\">\r\n          <p className=\"text-xs font-bold text-gray-400\">\r\n            {t.noAccount} <span onClick={() => navigate('/auth')} className=\"text-[#1A365D] cursor-pointer hover:underline\">{t.createAccount}</span>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}