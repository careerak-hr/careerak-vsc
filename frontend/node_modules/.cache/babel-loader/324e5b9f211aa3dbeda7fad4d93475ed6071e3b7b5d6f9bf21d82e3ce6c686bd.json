{"ast":null,"code":"import axios from'axios';import{Preferences}from'@capacitor/preferences';import CryptoJS from'crypto-js';const SECRET_KEY='careerak_secure_key_2024';// العناوين المتاحة\nconst LOCAL_SERVER='http://192.168.1.5:5000/api';const TUNNEL_BRIDGE='https://careerak-server.loca.lt/api';const api=axios.create({baseURL:LOCAL_SERVER,timeout:15000,headers:{'Content-Type':'application/json','Bypass-Tunnel-Reminder':'true'}});// اكتشاف السيرفر وحفظه\nexport const discoverBestServer=async()=>{try{// محاولة استعادة السيرفر المحفوظ أولاً\nconst{value:savedURL}=await Preferences.get({key:'cached_api_url'});if(savedURL){try{await axios.get(\"\".concat(savedURL,\"/users/health-check\"),{timeout:2000});api.defaults.baseURL=savedURL;return savedURL;}catch(e){await Preferences.remove({key:'cached_api_url'});}}const servers=[LOCAL_SERVER,TUNNEL_BRIDGE];for(const url of servers){try{await axios.get(\"\".concat(url,\"/users/health-check\"),{timeout:3000});api.defaults.baseURL=url;await Preferences.set({key:'cached_api_url',value:url});return url;}catch(e){continue;}}}catch(err){console.error('Discovery Error:',err);}return api.defaults.baseURL;};// التوكن\napi.interceptors.request.use(async config=>{try{const{value:encryptedToken}=await Preferences.get({key:'auth_token'});if(encryptedToken){const bytes=CryptoJS.AES.decrypt(encryptedToken,SECRET_KEY);const token=bytes.toString(CryptoJS.enc.Utf8);if(token){config.headers.Authorization=\"Bearer \".concat(token);}}}catch(error){console.error('API Interceptor Error:',error);}return config;},error=>Promise.reject(error));// معالجة فشل الاتصال وإعادة الاكتشاف التلقائي\napi.interceptors.response.use(response=>response,async error=>{const originalRequest=error.config;// التحقق مما إذا كان الخطأ بسبب فشل الشبكة (لا يوجد رد) ولم يتم المحاولة مسبقاً\nif(!error.response&&!originalRequest._retry){originalRequest._retry=true;try{// مسح الكاش القديم والبحث عن أفضل سيرفر متاح حالياً\nawait Preferences.remove({key:'cached_api_url'});const newBaseURL=await discoverBestServer();// تحديث الطلب الفاشل بالعنوان الجديد وإعادة المحاولة\noriginalRequest.baseURL=newBaseURL;return api(originalRequest);}catch(discoveryError){return Promise.reject(discoveryError);}}return Promise.reject(error);});// الخدمات\nexport const userService={register:userData=>api.post('/users/register',userData),login:credentials=>api.post('/users/login',credentials),getProfile:()=>api.get('/users/profile'),updateProfile:data=>api.put('/users/profile',data),healthCheck:()=>api.get('/users/health-check'),analyzeImage:data=>api.post('/ai/analyze-image',data),parseCV:data=>api.post('/ai/parse-cv',data),parseSocial:data=>api.post('/ai/parse-social',data)};export const jobPostingService={getAll:()=>api.get('/job-postings'),getById:id=>api.get(\"/job-postings/\".concat(id)),create:data=>api.post('/job-postings',data)};export const educationalCourseService={getAll:()=>api.get('/educational-courses'),getById:id=>api.get(\"/educational-courses/\".concat(id))};export const trainingCourseService={getAll:()=>api.get('/training-courses'),getById:id=>api.get(\"/training-courses/\".concat(id))};export default api;","map":{"version":3,"names":["axios","Preferences","CryptoJS","SECRET_KEY","LOCAL_SERVER","TUNNEL_BRIDGE","api","create","baseURL","timeout","headers","discoverBestServer","value","savedURL","get","key","concat","defaults","e","remove","servers","url","set","err","console","error","interceptors","request","use","config","encryptedToken","bytes","AES","decrypt","token","toString","enc","Utf8","Authorization","Promise","reject","response","originalRequest","_retry","newBaseURL","discoveryError","userService","register","userData","post","login","credentials","getProfile","updateProfile","data","put","healthCheck","analyzeImage","parseCV","parseSocial","jobPostingService","getAll","getById","id","educationalCourseService","trainingCourseService"],"sources":["D:/Careerak/Careerak-vsc/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst SECRET_KEY = 'careerak_secure_key_2024';\r\n\r\n// العناوين المتاحة\r\nconst LOCAL_SERVER = 'http://192.168.1.5:5000/api';\r\nconst TUNNEL_BRIDGE = 'https://careerak-server.loca.lt/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: LOCAL_SERVER,\r\n  timeout: 15000,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n    'Bypass-Tunnel-Reminder': 'true'\r\n  }\r\n});\r\n\r\n// اكتشاف السيرفر وحفظه\r\nexport const discoverBestServer = async () => {\r\n  try {\r\n    // محاولة استعادة السيرفر المحفوظ أولاً\r\n    const { value: savedURL } = await Preferences.get({ key: 'cached_api_url' });\r\n    if (savedURL) {\r\n      try {\r\n        await axios.get(`${savedURL}/users/health-check`, { timeout: 2000 });\r\n        api.defaults.baseURL = savedURL;\r\n        return savedURL;\r\n      } catch (e) {\r\n        await Preferences.remove({ key: 'cached_api_url' });\r\n      }\r\n    }\r\n\r\n    const servers = [LOCAL_SERVER, TUNNEL_BRIDGE];\r\n    for (const url of servers) {\r\n      try {\r\n        await axios.get(`${url}/users/health-check`, { timeout: 3000 });\r\n        api.defaults.baseURL = url;\r\n        await Preferences.set({ key: 'cached_api_url', value: url });\r\n        return url;\r\n      } catch (e) {\r\n        continue;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error('Discovery Error:', err);\r\n  }\r\n  return api.defaults.baseURL;\r\n};\r\n\r\n// التوكن\r\napi.interceptors.request.use(async (config) => {\r\n  try {\r\n    const { value: encryptedToken } = await Preferences.get({ key: 'auth_token' });\r\n    if (encryptedToken) {\r\n      const bytes = CryptoJS.AES.decrypt(encryptedToken, SECRET_KEY);\r\n      const token = bytes.toString(CryptoJS.enc.Utf8);\r\n      if (token) {\r\n        config.headers.Authorization = `Bearer ${token}`;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('API Interceptor Error:', error);\r\n  }\r\n  return config;\r\n}, (error) => Promise.reject(error));\r\n\r\n// معالجة فشل الاتصال وإعادة الاكتشاف التلقائي\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n\r\n    // التحقق مما إذا كان الخطأ بسبب فشل الشبكة (لا يوجد رد) ولم يتم المحاولة مسبقاً\r\n    if (!error.response && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      try {\r\n        // مسح الكاش القديم والبحث عن أفضل سيرفر متاح حالياً\r\n        await Preferences.remove({ key: 'cached_api_url' });\r\n        const newBaseURL = await discoverBestServer();\r\n\r\n        // تحديث الطلب الفاشل بالعنوان الجديد وإعادة المحاولة\r\n        originalRequest.baseURL = newBaseURL;\r\n        return api(originalRequest);\r\n      } catch (discoveryError) {\r\n        return Promise.reject(discoveryError);\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// الخدمات\r\nexport const userService = {\r\n  register: (userData) => api.post('/users/register', userData),\r\n  login: (credentials) => api.post('/users/login', credentials),\r\n  getProfile: () => api.get('/users/profile'),\r\n  updateProfile: (data) => api.put('/users/profile', data),\r\n  healthCheck: () => api.get('/users/health-check'),\r\n  analyzeImage: (data) => api.post('/ai/analyze-image', data),\r\n  parseCV: (data) => api.post('/ai/parse-cv', data),\r\n  parseSocial: (data) => api.post('/ai/parse-social', data)\r\n};\r\n\r\nexport const jobPostingService = {\r\n  getAll: () => api.get('/job-postings'),\r\n  getById: (id) => api.get(`/job-postings/${id}`),\r\n  create: (data) => api.post('/job-postings', data),\r\n};\r\n\r\nexport const educationalCourseService = {\r\n  getAll: () => api.get('/educational-courses'),\r\n  getById: (id) => api.get(`/educational-courses/${id}`),\r\n};\r\n\r\nexport const trainingCourseService = {\r\n  getAll: () => api.get('/training-courses'),\r\n  getById: (id) => api.get(`/training-courses/${id}`),\r\n};\r\n\r\nexport default api;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}