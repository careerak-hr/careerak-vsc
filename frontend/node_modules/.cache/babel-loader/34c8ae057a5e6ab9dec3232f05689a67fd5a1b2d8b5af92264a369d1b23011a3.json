{"ast":null,"code":"import axios from'axios';import{Preferences}from'@capacitor/preferences';const LOCAL_SERVER='http://192.168.1.5:5000/api';const TUNNEL_BRIDGE='https://careerak-server.loca.lt/api';const BOOTSTRAP_URL='https://bootstrap-vercel-a3w37so3b-careeraks-projects.vercel.app/api/bootstrap';export const api=axios.create({timeout:15000,headers:{'Content-Type':'application/json'}});/**\r\n * اكتشاف أفضل سيرفر متاح\r\n */export const discoverBestServer=async()=>{// 1️⃣ استخدام الكاش أولاً\nconst cached=await Preferences.get({key:'cached_api_url'});if(cached.value){try{await axios.get(\"\".concat(cached.value,\"/users/health-check\"),{timeout:2000});api.defaults.baseURL=cached.value;return cached.value;}catch(_unused){await Preferences.remove({key:'cached_api_url'});}}// 2️⃣ Bootstrap (الحل الإنتاجي)\ntry{var _response$data;const response=await axios.get(BOOTSTRAP_URL,{timeout:5000});const newBaseURL=(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.apiBaseUrl;if(newBaseURL){api.defaults.baseURL=newBaseURL;await Preferences.set({key:'cached_api_url',value:newBaseURL});return newBaseURL;}}catch(e){console.warn('Bootstrap failed');}// 3️⃣ Fallback (للتطوير فقط)\nconst fallbacks=[LOCAL_SERVER,TUNNEL_BRIDGE];for(const url of fallbacks){try{await axios.get(\"\".concat(url,\"/users/health-check\"),{timeout:3000});api.defaults.baseURL=url;await Preferences.set({key:'cached_api_url',value:url});return url;}catch(_unused2){}}throw new Error('No backend available');};/**\r\n * Self-healing interceptor\r\n */api.interceptors.response.use(response=>response,async error=>{const originalRequest=error.config;if(!error.response&&!originalRequest._retry){originalRequest._retry=true;try{await Preferences.remove({key:'cached_api_url'});const newBaseURL=await discoverBestServer();originalRequest.baseURL=newBaseURL;return api(originalRequest);}catch(e){return Promise.reject(e);}}return Promise.reject(error);});","map":{"version":3,"names":["axios","Preferences","LOCAL_SERVER","TUNNEL_BRIDGE","BOOTSTRAP_URL","api","create","timeout","headers","discoverBestServer","cached","get","key","value","concat","defaults","baseURL","_unused","remove","_response$data","response","newBaseURL","data","apiBaseUrl","set","e","console","warn","fallbacks","url","_unused2","Error","interceptors","use","error","originalRequest","config","_retry","Promise","reject"],"sources":["D:/Careerak/Careerak-vsc/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\nimport { Preferences } from '@capacitor/preferences';\r\n\r\nconst LOCAL_SERVER = 'http://192.168.1.5:5000/api';\r\nconst TUNNEL_BRIDGE = 'https://careerak-server.loca.lt/api';\r\nconst BOOTSTRAP_URL =\r\n  'https://bootstrap-vercel-a3w37so3b-careeraks-projects.vercel.app/api/bootstrap';\r\n\r\nexport const api = axios.create({\r\n  timeout: 15000,\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n});\r\n\r\n/**\r\n * اكتشاف أفضل سيرفر متاح\r\n */\r\nexport const discoverBestServer = async () => {\r\n  // 1️⃣ استخدام الكاش أولاً\r\n  const cached = await Preferences.get({ key: 'cached_api_url' });\r\n  if (cached.value) {\r\n    try {\r\n      await axios.get(`${cached.value}/users/health-check`, { timeout: 2000 });\r\n      api.defaults.baseURL = cached.value;\r\n      return cached.value;\r\n    } catch {\r\n      await Preferences.remove({ key: 'cached_api_url' });\r\n    }\r\n  }\r\n\r\n  // 2️⃣ Bootstrap (الحل الإنتاجي)\r\n  try {\r\n    const response = await axios.get(BOOTSTRAP_URL, { timeout: 5000 });\r\n    const newBaseURL = response.data?.apiBaseUrl;\r\n    if (newBaseURL) {\r\n      api.defaults.baseURL = newBaseURL;\r\n      await Preferences.set({ key: 'cached_api_url', value: newBaseURL });\r\n      return newBaseURL;\r\n    }\r\n  } catch (e) {\r\n    console.warn('Bootstrap failed');\r\n  }\r\n\r\n  // 3️⃣ Fallback (للتطوير فقط)\r\n  const fallbacks = [LOCAL_SERVER, TUNNEL_BRIDGE];\r\n  for (const url of fallbacks) {\r\n    try {\r\n      await axios.get(`${url}/users/health-check`, { timeout: 3000 });\r\n      api.defaults.baseURL = url;\r\n      await Preferences.set({ key: 'cached_api_url', value: url });\r\n      return url;\r\n    } catch {}\r\n  }\r\n\r\n  throw new Error('No backend available');\r\n};\r\n\r\n/**\r\n * Self-healing interceptor\r\n */\r\napi.interceptors.response.use(\r\n  response => response,\r\n  async error => {\r\n    const originalRequest = error.config;\r\n\r\n    if (!error.response && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      try {\r\n        await Preferences.remove({ key: 'cached_api_url' });\r\n        const newBaseURL = await discoverBestServer();\r\n        originalRequest.baseURL = newBaseURL;\r\n        return api(originalRequest);\r\n      } catch (e) {\r\n        return Promise.reject(e);\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}