{"ast":null,"code":"import axios from'axios';import{Preferences}from'@capacitor/preferences';// عناوين احتياطية\nconst LOCAL_SERVER='http://192.168.1.5:5000/api';const TUNNEL_BRIDGE='https://careerak-server.loca.lt/api';const BOOTSTRAP_URL='https://bootstrab-vercel-a3w37so3b-careeraks-projects.vercel.app/api/bootstrap';// ✅ تعريف واحد فقط\nconst api=axios.create({baseURL:LOCAL_SERVER,timeout:15000,headers:{'Content-Type':'application/json'}});// اكتشاف أفضل سيرفر\nexport const discoverBestServer=async()=>{try{var _res$data;// 1️⃣ جرّب المحفوظ\nconst{value:cached}=await Preferences.get({key:'cached_api_url'});if(cached){try{await axios.get(\"\".concat(cached,\"/users/health-check\"),{timeout:3000});api.defaults.baseURL=cached;return cached;}catch(_unused){}}// 2️⃣ جرّب المحلي / النفق\nconst servers=[LOCAL_SERVER,TUNNEL_BRIDGE];for(const url of servers){try{await axios.get(\"\".concat(url,\"/users/health-check\"),{timeout:3000});api.defaults.baseURL=url;await Preferences.set({key:'cached_api_url',value:url});return url;}catch(_unused2){}}// 3️⃣ Bootstrap\nconst res=await axios.get(BOOTSTRAP_URL,{timeout:5000});if((_res$data=res.data)!==null&&_res$data!==void 0&&_res$data.apiBaseUrl){api.defaults.baseURL=res.data.apiBaseUrl;await Preferences.set({key:'cached_api_url',value:res.data.apiBaseUrl});return res.data.apiBaseUrl;}}catch(e){console.error('Server discovery failed',e);}return api.defaults.baseURL;};// إعادة الاكتشاف عند فشل الشبكة\napi.interceptors.response.use(res=>res,async error=>{const original=error.config;if(!error.response&&!original._retry){original._retry=true;await Preferences.remove({key:'cached_api_url'});const newURL=await discoverBestServer();if(newURL){original.baseURL=newURL;return api(original);}}return Promise.reject(error);});// ✅ هذا هو التصدير الوحيد\nexport default api;","map":{"version":3,"names":["axios","Preferences","LOCAL_SERVER","TUNNEL_BRIDGE","BOOTSTRAP_URL","api","create","baseURL","timeout","headers","discoverBestServer","_res$data","value","cached","get","key","concat","defaults","_unused","servers","url","set","_unused2","res","data","apiBaseUrl","e","console","error","interceptors","response","use","original","config","_retry","remove","newURL","Promise","reject"],"sources":["D:/Careerak/Careerak-vsc/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\nimport { Preferences } from '@capacitor/preferences';\r\n\r\n// عناوين احتياطية\r\nconst LOCAL_SERVER = 'http://192.168.1.5:5000/api';\r\nconst TUNNEL_BRIDGE = 'https://careerak-server.loca.lt/api';\r\nconst BOOTSTRAP_URL =\r\n  'https://bootstrab-vercel-a3w37so3b-careeraks-projects.vercel.app/api/bootstrap';\r\n\r\n// ✅ تعريف واحد فقط\r\nconst api = axios.create({\r\n  baseURL: LOCAL_SERVER,\r\n  timeout: 15000,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\n// اكتشاف أفضل سيرفر\r\nexport const discoverBestServer = async () => {\r\n  try {\r\n    // 1️⃣ جرّب المحفوظ\r\n    const { value: cached } = await Preferences.get({ key: 'cached_api_url' });\r\n    if (cached) {\r\n      try {\r\n        await axios.get(`${cached}/users/health-check`, { timeout: 3000 });\r\n        api.defaults.baseURL = cached;\r\n        return cached;\r\n      } catch {}\r\n    }\r\n\r\n    // 2️⃣ جرّب المحلي / النفق\r\n    const servers = [LOCAL_SERVER, TUNNEL_BRIDGE];\r\n    for (const url of servers) {\r\n      try {\r\n        await axios.get(`${url}/users/health-check`, { timeout: 3000 });\r\n        api.defaults.baseURL = url;\r\n        await Preferences.set({ key: 'cached_api_url', value: url });\r\n        return url;\r\n      } catch {}\r\n    }\r\n\r\n    // 3️⃣ Bootstrap\r\n    const res = await axios.get(BOOTSTRAP_URL, { timeout: 5000 });\r\n    if (res.data?.apiBaseUrl) {\r\n      api.defaults.baseURL = res.data.apiBaseUrl;\r\n      await Preferences.set({\r\n        key: 'cached_api_url',\r\n        value: res.data.apiBaseUrl,\r\n      });\r\n      return res.data.apiBaseUrl;\r\n    }\r\n  } catch (e) {\r\n    console.error('Server discovery failed', e);\r\n  }\r\n\r\n  return api.defaults.baseURL;\r\n};\r\n\r\n// إعادة الاكتشاف عند فشل الشبكة\r\napi.interceptors.response.use(\r\n  (res) => res,\r\n  async (error) => {\r\n    const original = error.config;\r\n    if (!error.response && !original._retry) {\r\n      original._retry = true;\r\n      await Preferences.remove({ key: 'cached_api_url' });\r\n      const newURL = await discoverBestServer();\r\n      if (newURL) {\r\n        original.baseURL = newURL;\r\n        return api(original);\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// ✅ هذا هو التصدير الوحيد\r\nexport default api;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}